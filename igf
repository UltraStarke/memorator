import  telebot
from telebot import types
import requests
import random
import os.path
from  PIL import Image, ImageDraw, ImageFont

bot = telebot.TeleBot('Token')

path = 'memes path'

def image_counter():
    num_files = len([f for f in os.listdir(path)
                     if os.path.isfile(os.path.join(path, f))])
    return(num_files)

def strip_draw(im):
    strip = ImageDraw.Draw(im)
    strip.rectangle((0,0,im.width,int(im.height/15)), fill = 'black')
    return im

def text_draw(im,txt):
    fnt = ImageFont.truetype('/home/user/Загрузки/mem_font.ttf',size = int(im.height/20))
    draw = ImageDraw.Draw(strip_draw(im))
    draw.text((int(im.width/10),int(im.height/3000)),txt,font = fnt)
    return im

@bot.message_handler(content_types=['text'])
def get_text_messages(message):
    rnd = random.randint(1,image_counter())
    mem = Image.open('memes path'+str(rnd)+'.jpg')
    bot.send_photo(message.from_user.id, text_draw(mem, message.text))
    print(message.from_user.id)
    print(message.text)
    
@bot.message_handler(content_types=['photo'])
def photo(message):
    fileID = message.photo[-1].file_id
    file_info = bot.get_file(fileID)
    print(file_info)
    downloaded_file = bot.download_file(file_info.file_path)
    with open(path+'/'+str(image_counter())+".jpg", 'wb') as new_file:
        new_file.write(downloaded_file)
    bot.send_message(message.from_user.id, 'я запомнил и теперь помню '+str(image_counter())+' фоток ' )

bot.polling(none_stop=True, interval=0)
